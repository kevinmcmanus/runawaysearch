
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

import astropy.units as u
from scipy.stats import chi2

if __name__ == '__main__':

    import os
    print(f'Current Working Directory: {os.getcwd()}')

    from perryman import perryman

    center_motion = {
    'd_xyz': np.array([[-13.76187842],
            [ 23.57255348],
            [ -2.02249172]]),
    'd_xyz_covar': np.array([[ 43.76306096, 105.99518972,  34.80672399],
            [105.99518972, 314.7331364 , 106.98718194],
            [ 34.80672399, 106.98718194,  41.6002135 ]]),
    'tangental_velocity': np.array([[21.60904282],
            [-7.12420731],
            [15.33640148]])}

    cluster_names = ['Pleiades', 'alphaPer','Hyades']
    search_results = {}

    from gaiastars import from_pickle

    for cl in cluster_names:
        search_results[cl] = from_pickle(f'./data/search_results_{cl}.pkl')
        print(search_results[cl])

    init_members = [       
        45142206521351552, 3313285110990793472, 145664777917536512, 3294248609046258048, 3283285795218796800,
        3388509470313327104, 47345009348203392, 3306922958753764992, 145391484855481344, 3412331901556818048,
        3410856112139584000, 3288997483247358592, 47715063730746880, 45293526808851200, 3406734906335151872,
        3411758128287351808, 3412605297699792512, 3282226793722500224, 3282171749421655168, 147258180719392512,
        3410944730200538496, 3307782570688378496, 3309918646903563264, 3313978112552491136, 3303984513928122752,
        3410076150374417408, 3308470968047333120, 3408504261063819520, 3413860050922284672, 3411128795318922496,
        3338847893045082880, 3313759000500605056, 3310178784482082816, 3314063908819076352, 164216120356193664,
        148946068508277888, 3310348551653256448, 145293181643038208, 51995909173956352, 3314597408180024960,
        3408234502757515648, 38670343642226816, 3307528033746225664, 3313630082762446208, 3314109916508904064,
        3314213025787054592, 144663157183364864, 3405127244241184256, 3407121831350730112, 3314212068010812032
        ]

    #shorter list
    #init_members = [3410944730200538496, 3307782570688378496, 3309918646903563264, 3313978112552491136, 3303984513928122752]

    hyades=sr = perryman(search_results['Hyades'].objs, init_members)
    hyades.fit()
